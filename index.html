<html>
  <head>
    <link rel="stylesheet" href="css/bootstrap.css">
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script src="js/three.min.js"></script>
    <script src="js/graph.js"></script>
    <script type="text/javascript">
      var structs = {
        fulereno: '0 33\n33 1\n1 34\n34 2\n2 35\n35 3\n4 36\n36 5\n5 37\n37 6\n6 38\n38 7\n7 39\n39 8\n9 32\n32 0\n33 43\n34 44\n35 46\n36 47\n37 49\n38 50\n39 40\n32 41\n43 44\n44 45\n45 46\n46 47\n47 48\n48 49\n49 50\n50 51\n51 40\n40 41\n41 42\n42 43\n42 52\n45 53\n48 53\n51 52\n52 53\n0 11\n11 1\n1 12\n12 2\n2 13\n13 3\n4 14\n14 5\n5 15\n15 6\n6 16\n16 7\n7 17\n17 8\n9 10\n10 0\n11 21\n12 22\n13 24\n14 25\n15 27\n16 28\n17 18\n10 19\n21 22\n22 23\n23 24\n24 25\n25 26\n26 27\n27 28\n28 29\n29 18\n18 19\n19 20\n20 21\n20 30\n23 31\n26 31\n29 30\n30 31\n3 4\n8 9',
        c2h6: 'c1 h1\nc1 h2\nc1 h3\nc1 c2\nc2 h4\nc2 h5\nc2 h6',
        cube: 'a1 a2\na2 a3\na3 a4\na4 a1\nb1 b2\nb2 b3\nb3 b4\nb4 b1\na1 b1\na2 b2\na3 b3\na4 b4'
      };

      function get_bonds(s){
        var lines = s.split("\n");
        var bonds = [];
        var vertmap = {};
        var index = 0;

        function _getindex(v){
          if(!(v in vertmap)){
            vertmap[v] = index++;
          }
          return vertmap[v];
        }

        for(var i in lines){
          var line = lines[i].trim();
          if(line){
            var nodes = line.split(" ");
            var v1 = nodes[0];
            var v2 = nodes[1];
            var i1 = _getindex(v1);
            var i2 = _getindex(v2);
            bonds.push([i1, i2]);
          }
        }
        return bonds;
      }

      function select_struct(e){
        document.getElementById('ta').value = structs[e.selectedOptions[0].value];
      }

      var bonds;

      function go(){
        bonds = get_bonds(document.getElementById('ta').value );
        window.animh = _3dgraph();
      }

      function zoomin(){
        window.animh.camera.position.z -= 50;
      }

      function zoomout(){
        window.animh.camera.position.z += 50;
      }
    </script>

  </head>
  <body>
    <div class="container-fluid" style="margin: 30px;">
      <div class="row-fluid">
        <div class="span3">
          <div class="alert alert-info">
            <h3>3D Graph renderer</h3>
            <p>Nodes repel each other (1/distance^2) and connections behave like springs (K * delta_length)</p>
            <p>Select a structure, modify if you want, and click Go.</p>
            <p><a href="https://github.com/tonylampada/webgl_graphs/tree/gh-pages">Fork me on Github</a> (maybe add some structures?)</p>
          </div>

          <div>
            Select structure 
            <select id="e" onchange="select_struct(this)">
              <option value="fulereno">Fulereno (sqn)</option>
              <option value="c2h6">c2h6</option>
              <option value="cube">cube</option>
            </select>
          </div>

          <div>
            Bonds
            <textarea id="ta" style="height: 150px"></textarea>
          </div>

          <div>
            <button onclick="go()">Go</button>
          </div>
          <div>
            Zoom
            <button onclick="zoomin()">+</button>
            <button onclick="zoomout()">-</button>
          </div>
        </div><!--/span-->
        <div class="span9" id="renderHere" style="border: solid 1px; height: 80%">
        </div><!--/span-->
      </div><!--/row-->
    </div>
  </body>
  <script type="text/javascript">
    var e = document.getElementById('e');
    document.getElementById('ta').value = structs[e.selectedOptions[0].value];
    go();
  </script>
</html>